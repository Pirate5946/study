    Java语言规范到Java虚拟机语言规范的转化 ，由Javac编译器完成，将Java源代码转换成字节码

### 目录导航
- ####  Javac的语法树结构
- #### Javac的工作流程
> 词法分析、语法分析、符号表的构建、annotation处理、标注和语法检查、数据流分析、 类型转化、Java如何实现内部类、对异常的处理、Javac与其他编译器的比较

### 4.1 Javac是什么
-   Javac是一种编译器、能将一种语言规范转换成另一种语言规范
- Java源码通过编译器被编译成能被JVM识别的语言(二进制码)，再由JVM将当前二进制码转化成能被不同机器的CPU执行的指令集合

### 4.2 Javac编译器的基本结构       p91
    1、词法分析：逐个字节读取源代码并识别此法关键字
    2、语法分析：分析Token流
    3、抽象语法树：结构化的语法表达形式
    4、语义分析：将复杂语法转化成 最简单的语法
    5、生成字节码：通过字节码生成器，根据经过注解的抽象语法树生成符合Java虚拟机规范的字节码

### 4.3 Javac工作原理分析
#### 4.3.1 词法分析器       p93
    JDK的编译器类：com.sun.tools.javac.main.Main 的compile(String[])方法
> Javac的主要词法分析器的接口类：com.sun.tools.javac.parser.Lexer,它的默认实现类是com.sun.tools.javac.parser.Scanner,Scanner会逐个读取Java源文件的单个字符，然后解析出符合Java语言规范的Token序列

> 词法分析器类图分析：两个Factory生成了两个接口的实现类Scanner和JavaParser,这两个类负责词法分析的过程控制，JavaParser规定了哪些词是符合Java语言规范的，Scanner完成具体读取和归类不同词法。Token规定了所有Java语言的合法关键词，Names用来存储和表示解析后的词法

> 词法分析过程是在JavaParser的 
parseCompilationUnit方法中完成的    p94

>Javac分析词法的原貌：从源文件的一个字符开始，按照Java语法规范一次找出 package、import、类定义以及属性和方法定义，最后构架一个抽象语法树

#### 4.3.2  语法分析器  p100

#### 4.3.3  语义分析器  p105

#### 4.3.4  代码生成器  p115
> 经过语义分析器完成后的代码树已经非常完善了，接下来Javac会调用 ==com.sun.tools.javac.jvm.Gen== 类遍历语法树，生成最终的Java字节码

##### 生成Java字节码需要经历一下两个步骤
- 将Java方法中的代码块转换成符合JVM语法的命令形式，**JVM的操作都是基于栈的，所有的操作都必须经过进栈和出栈来完成**
- 按照JVM的文件组织格式将字节码输出到以class为扩展名的文件中

>生成字节码除了==com.sun.tools.javac.jvm.Gen==类之外还有两个辅助类
-   Items
-   Code

### 4.4 访问者模式

#### 4.4.1 访问者模式的结构
>访问者模式的设计初衷是为了将稳定的数据结构，和对数据结构的复杂操作解耦，让设计者对同一套数据结构自由地设计操作集合

>访问者模式一般有 抽象访问者、具体访问者、抽象节点元素、具体节点元素、结构对象和客户端 几种角色

-  抽象访问者（Visitor）：声明所有访问者需要的接口
-  具体访问者（ConcreteVisitor）：实现抽象访问者声明的接口
-  抽象节点元素（Element）：提供一个接口，能够接受访问者作为参数传递给节点元素
-  具体节点元素（ConcreteElement）：实现抽象节点元素声明的接口
-  结构对象（ObjectStructure）：提供一个接口，能够访问到所有的节点元素，一般作为一个集合特有节点元素的引
-  客户端（Client）：分别创建访问者和节点元素的对象，调用访问者 访问变量节点元素
#### 4.4.2   Javac中访问者模式的实现        p120
>访问者模式可以将 数据结构 和对数据结构的操作解耦， 使得增加对数据结构的操作不需要去修改数据结构，也不必去修改原有的操作，在执行时再重新定义新的Visitor实现者就行了。

>在Javac中，不同的编译阶段都定义了不同的访问者模式实现，

>Enter作为一个访问者，实现了抽象访问者Visito中的所有接口，但是Enter这个访问者具体要实现什么功能 由Enter自己定义。遍历这棵树使用统一接口accept，每个节点元素都实现这个accept，但是不同节点元素的accept的实现是不同的，以区分不同的节点元素对应不同的功能

### 4.5 总结
>  Javac是如何将 Java的源代码一步步转换成目标的class字节码文件

>   编译器主要的几个处理阶段：

-   词法分析
-   语法分析
-   语义分析
-   代码生成
-   Javac的核心设计模式     基于访问者模式遍历语法树
-   

1
1