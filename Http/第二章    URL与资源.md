URL 就是因特网资源的标准化名称。URL 指向一条电子信息片段，告诉你它们位于何处，以及如何与之进行交互。
本章，我们将介绍以下内容：
URL 语法，. 以及各种 URL 组件的含义及其所做的工作；
  ● 很多 Web 客户端都支持的 URL 快捷方式，包括相对 URL 和自动扩展 URL；
  ● URL 编码和字符规则；
  ● 支持各种因特网信息系统的常见 URL 方案；
  ● URL 的未来，包括 URN——这种框架可以在对象从一处搬移到另一处时，保持稳定的访问名称。

2.1　浏览因特网资源				p26
URL 是浏览器寻找信息时所需的资源位置。通过URL，人类和应用程序才能找到、使用并共享因特网上大量的数据资源。URL 是人们对HTTP 和其他协议的常用访问点：一个人将浏览器指向一个URL，浏览器就会在幕后发送适当的协议报文来获取人们所期望的资源。
URI 是一类更通用的资源标识符，URL 实际上是它的一个子集。URI 是一个通用的概念，由两个主要的子集URL 和URN 构成，URL 是通过描述资源的位置来标识资源的，而URN（本章稍后会介绍）则是通过名字来识别资源的，与它们当前所处位置无关。
HTTP 规范将更通用的概念URI 作为其资源标识符，但实际上，HTTP 应用程序处理的只是URI 的URL 子集。本书有时会不加区分地使用URI 和URL，但我们讲的基本上都是URL。

比如说，你想要获取URL http://www.joes-hardware.com/seasonal/index-fall.html。
那么URL 分以下三部分。
  ● URL 的第一部分（http）是 URL 方案（scheme）。方案可以告知 Web 客户端怎样访问资源。在这个例子中，URL 说明要使用HTTP 协议。
  ● URL 的第二部分（www.joes-hardware.com）指的是服务器的位置（主机名或者IP地址）。这部分告知Web 客户端资源位于何处。
  ● URL 的第三部分（/seasonal/index-fall.html）是资源路径。路径说明了请求的是服务器上哪个特定的本地资源。

URL 可以通过HTTP 之外的其他协议来访问资源。它们可以指向因特网上的任意资源，或者个人的E-mail 账户：
mailto:president@whitehouse.gov
或者通过其他协议（比如FTP 协议）访问的各种文件：
ftp://ftp.lots-o-books.com/pub/complete-price-list.xls
或者从流视频服务器上下载电影：
rtsp://www.joes-hardware.com:554/interview/cto_video

URL 提供了一种统一的资源命名方式。大多数URL 都有同样的：“方案:// 服务器位置/ 路径”结构。因此，对网络上的每个资源以及获取这些资源的每种方式来说，命名资源的方法都只有一种，这样不管是谁都可以用名字来找到这个资源了
URL出现之前的黑暗岁月					p28
URL 为应用程序提供了一种访问资源的手段。实际上，很多用户可能都不知道他们的浏览器在获取所请求资源时所使用的协议和访问方法。应用程序可以使用URL 来简化信息的访问过程。

2.2　URL的语法				p28
URL提供了一种定位因特网上任意资源的手段，但这些资源是可以通过各种不同的方案（比如HTTP、FTP、SMTP）来访问的，因此URL 语法会随方案的不同而有所不同。
大部分URL 都遵循通用的URL 语法，而且不同URL 方案的风格和语法都有不少重叠。
大多数URL 方案的URL 语法都建立在这个由9 部分构成的通用格式上：
<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>
几乎没有哪个URL 中包含了所有这些组件。URL 最重要的3 个部分是方案（scheme）、主机（host）和路径（path）。表2-1 对各种组件进行了总结。
组　　件				描　　述							默　认　值
方案			访问服务器以获取资源时要使用哪种协议				无
用户			某些方案访问资源时需要的用户名					匿名
密码		用户名后面可能要包含的密码，中间由冒号（:）分隔		<E-mail 地址>
主机			资源宿主服务器的主机名或点分IP 地址				无
端口													每个方案特有
资源宿主服务器正在监听的端口号。很多方案都有默认端	 口号（HTTP 的默认端口号为80）													
路径														无
服务器上资源的本地名，由一个斜杠（/）将其与前面的URL 组件分隔开来。路径组件的语法是与服务器和方案有关的（本章稍后会讲到URL 路径可以分为若干个段，每段都可以有其特有的组件。）													
参数														无
某些方案会用这个组件来指定输入参数。参数为名/ 值对。URL 中可以包含多个参数字段，它们相互之间以及与路径的其余部分之间用分号（;）分隔			
查询														  无
   某些方案会用这个组件传递参数以激活应用程序（比如数据库、公告板、搜索引擎以及其他因特网网关）。查询组件的内容没有通用格式。用字符“?”将其与URL 的其余部分分隔开来
片段														无
一小片或一部分资源的名字。引用对象时，不会将frag 字段传送给服务器；这个字段是在客户端内部使用的。通过字符“#”将其与URL 的其余部分分隔开来

比如，我们来看看URL：http://www.joeshardware.com:80/index.html，其方案是http，主机为www.joes-hardware.com，端口是80，路径为/index.html。

2.2.1　方案——使用什么协议
方案实际上是规定如何访问指定资源的主要标识符，它会告诉负责解析URL 的应用程序应该使用什么协议。在我们这个简单的HTTP URL 中所使用的方案就是http。
方案组件必须以一个字母符号开始，由第一个“:”符号将其与URL 的其余部分分隔开来。方案名是大小写无关的，因此URL“http://www.joes-hardware.com”和“HTTP://www.joes-hardware.com”是等价的。

2.2.2　主机与端口
要想在因特网上找到资源，应用程序要知道是哪台机器装载了资源，以及在那台机器的什么地方可以找到能对目标资源进行访问的服务器。URL 的主机和端口组件提供了这两组信息。
主机组件标识了因特网上能够访问资源的宿主机器。可以用上述主机名（www.joeshardware.com），或者IP 地址来表示主机名。比如，下面两个URL 就指向同一个资源——第一个URL 是通过主机名，第二个是通过IP 地址指向服务器的：
http://www.joes-hardware.com:80/index.html
http://161.58.228.45:80/index.html
端口组件标识了服务器正在监听的网络端口。对下层使用了TCP 协议的HTTP 来说，默认端口号为80。

2.2.3　用户名和密码
更有趣的组件是用户和密码组件。很多服务器都要求输入用户名和密码才会允许用户访问数据。FTP 服务器就是这样一个常见的实例。这里有几个例子：
ftp://ftp.prep.ai.mit.edu/pub/gnu
ftp://anonymous@ftp.prep.ai.mit.edu/pub/gnu
ftp://anonymous:my_passwd@ftp.prep.ai.mit.edu/pub/gnu
http://joe:joespasswd@www.joes-hardware.com/sales_info.txt
第一个例子没有用户或密码组件，只有标准的方案、主机和路径。如果某应用程序使用的URL 方案要求输入用户名和密码，比如FTP，但用户没有提供，它通常会插入一个默认的用户名和密码。比如，如果向浏览器提供一个FTP URL，但没有指定用户名和密码，它就会插入anonymous（匿名用户）作为你的用户名，并发送一个默认的密码（Internet Explorer 会发送IEUser，Netscape Navigator 则会发送
mozilla）。
第二个例子显示了一个指定为anonymous 的用户名。这个用户名与主机组件组合在一起，看起来就像E-mail 地址一样。字符“@”将用户和密码组件与URL 的其余部分分隔开来。
在第三个例子中，指定了用户名（anonymous）和密码（my_passwd），两者之间由字符“:”分隔。

2.2.4　路径
URL 的路径组件说明了资源位于服务器的什么地方。路径通常很像一个分级的文件系统路径。比如：
http://www.joes-hardware.com:80/seasonal/index-fall.html
这个URL 中的路径为/seasonal/index-fall.html，很像UNIX 文件系统中的文件系统路径。路径是服务器定位资源时所需的信息。可以用字符“/”将HTTP URL 的路径组件划分成一些路径段（path segment）（还是与UNIX 文件系统中的文件路径类似）。每个路径段都有自己的参数（param）组件。

2.2.5　参数							p31
对很多方案来说，只有简单的主机名和到达对象的路径是不够的。除了服务器正在监听的端口，以及是否能够通过用户名和密码访问资源外，很多协议都还需要更多的信息才能工作。
负责解析URL 的应用程序需要这些协议参数来访问资源。否则，另一端的服务器可能就不会为请求提供服务，或者更糟糕的是，提供错误的服务。比如，像FTP 这样的协议，有两种传输模式，二进制和文本形式。你肯定不希望以文本形式来传送二进制图片，这样的话，二进制图片可能会变得一团糟。
为了向应用程序提供它们所需的输入参数，以便正确地与服务器进行交互，URL 中有一个参数组件。这个组件就是URL 中的名值对列表，由字符“;”将其与URL 的其余部分（以及各名值对）分隔开来。它们为应用程序提供了访问资源所需的所有附加信息。比如：
ftp://prep.ai.mit.edu/pub/gnu;type=d
在这个例子中，有一个参数type=d，参数名为type，值为d。如前所述，HTTP URL 的路径组件可以分成若干路径段。每段都可以有自己的参数。比如：
http://www.joes-hardware.com/hammers;sale=false/index.html;graphics=true
这个例子就有两个路径段，hammers 和index.html。hammers 路径段有参数sale，其值为false。index.html 段有参数graphics，其值为true。

2.2.6　查询字符串					p32
很多资源，比如数据库服务，都是可以通过提问题或进行查询来缩小所请求资源类型范围的。
除了有些不合规则的字符需要特别处理之外，对查询组件的格式没什么要求。按照常规，很多网关都希望查询字符串以一系列“名/ 值”对的形式出现，名值对之间用字符“&”分隔：
http://www.joes-hardware.com/inventory-check.cgi?item=12731&color=blue
在这个例子中，查询组件有两个名/ 值对：item=12731 和color=blue。

2.2.7　片段
为了引用部分资源或资源的一个片段，URL 支持使用片段（frag）组件来表示一个资源内部的片段。比如，URL 可以指向HTML 文档中一个特定的图片或小节。
片段挂在URL 的右手边，最前面有一个字符“#”。比如：
http://www.joes-hardware.com/tools.html#drills
在这个例子中，片段drills 引用了Joe 的五金商店Web 服务器上页面/tools.html 中的一
个部分。这部分的名字叫做drills。
HTTP 服务器通常只处理整个对象，3 而不是对象的片段，客户端不能将片段传送给服务器（参见图2-3）。浏览器从服务器获得了整个资源之后，会根据片段来显示你感兴趣的那部分资源。

2.3　URL快捷方式					p35
Web 客户端可以理解并使用几种URL 快捷方式。相对URL 是在某资源内部指定一个资源的便捷缩略方式。很多浏览器还支持URL 的“自动扩展”，也就是用户输入URL 的一个关键（可记忆的）部分，然后由浏览器将其余部分填充起来。
2.3.1　相对URL
URL 有两种方式：绝对的和相对的。到目前为止，我们只见过绝对URL。绝对URL 中包含有访问资源所需的全部信息。另一方面，相对URL 是不完整的。要从相对URL 中获取访问资源所需的全部信息，就必须相对于另一个，被称为其基础（base）的URL 进行解析。
1. 基础URL
转换处理的第一步就是找到基础URL。基础URL 是作为相对URL 的参考点使用的。可以来自以下几个不同的地方。
  ● 在资源中显式提供
有些资源会显式地指定基础URL。比如，HTML 文档中可能会包含一个定义了基础URL 的HTML 标记<BASE>，通过它来转换那个HTML 文档中的所有相对URL。
  ● 封装资源的基础 URL
如果在一个没有显式指定基础URL 的资源中发现了一个相对URL，如例2-1 所示，可以将它所属资源的URL 作为基础（如例中所示）。
  ● 没有基础 URL
    在某些情况下，没有基础URL。这通常意味着你有一个绝对URL；但有时可能只是一个不完整或损坏了的URL。

2. 解析相对引用								p36		
前面我们介绍了URL 的基本组件和语法。要将相对URL 转换为一个绝对URL，下一步要做的就是将相对URL 和基础URL 划分成组件段。
实际上，这样只是在解析URL，但这种做法会将其划分成一个个组件，因此通常会称作分解（decomposing）URL。只要将基础和相对URL 划分成了组件，就可以应
用图2-5 中的算法来完成转换了。

2.3.2　自动扩展URL
有些浏览器会在用户提交URL 之后，或者在用户输入的时候尝试着自动扩展URL。这就为用户提供了一条捷径：用户不需要输入完整的URL，因为浏览器会自动扩展。这些“自动扩展”特性有以下两种方式。
• 主机名扩展
• 历史扩展

2.4　各种令人头疼的字符
URL 是可移植的（portable）。它要统一地命名因特网上所有的资源，这也就意味着要通过各种不同的协议来传送这些资源。这些协议在传输数据时都会使用不同的机制，所以，设计URL，使其可以通过任意因特网协议安全地传输是很重要的。
除了希望URL 可以被所有因特网协议进行传送之外，设计者们还希望URL 也可供人类阅读。因此，即使不可见、不可打印的字符能够穿过邮件程序，从而成为可移植的，也不能在URL 中使用。
URL 的设计者们认识到有时人们可能会希望URL 中包含除通用的安全字母表之外的二进制数据或字符。因此，需要有一种转义机制，能够将不安全的字符编码为安全字符，再进行传输。
本节总结了URL 的通用字母表和编码规则。
2.4.1　URL字符集
US-ASCII 使用7 位二进制码来表示英文打字机提供的大多数按键和少数用于文本格式和硬件通知的不可打印控制字符。有些URL 中还会包含任意的二进制数据。认识到对完整性的需求之后，URL的设计者就将转义序列集成了进去。通过转义序列，就可以用US-ASCII 字符集的有限子集对任意字符值或数据进行编码了，这样就实现了可移植性和完整性。
2.4.2　编码机制
为了避开安全字符集表示法带来的限制，人们设计了一种编码机制，用来在URL 中表示各种不安全的字符。这种编码机制就是通过一种“转义”表示法来表示不安全字符的，这种转义表示法包含一个百分号（%），后面跟着两个表示字符ASCII 码的十六进制数。
2.4.3　字符限制							p39
在URL 中，有几个字符被保留起来，有着特殊的含义。有些字符不在定义的USASCII可打印字符集中。还有些字符会与某些因特网网关和协议产生混淆，因此不赞成使用。表2-3 列出了一些字符，在将其用于保留用途之外的场合时，要在URL 中对其进行编码。
2.4.4　另外一点说明							p40
你可能会感到奇怪，为什么使用一些不安全字符的时候并没有发生什么不好的事情。比如，你可以访问http://www.joes-hardware.com/~joe 上的Joe 主页，而无需对“~”字符进行编码。对某些传输协议来说，这并不是什么问题，但对应用程序开发人员来说，对非安全字符进行编码仍然是明智的。

2.5　方案的世界					p41
本节将介绍更多Web 常用方案格式。附录A 给出了一个相当完整的方案列表，及各种方案文档的参考文献。
表2-4 总结了最常见的一些方案。回顾一下2.2 节有助于理解表格中的语法部分。
  ● http 
超文本传输协议方案，除了没有用户名和密码之外，与通用的URL 格式相符。如果省略了端口，就默认为80。
基本格式：
http://<host>:<port>/<path>?<query>#<frag>
示例：
http://www.joes-hardware.com/index.html
http://www.joes-hardware.com:80/index.html
  ● https 
方案https 与方案http 是一对。唯一的区别在于方案https 使用了网景的SSL，SSL 为
HTTP 连接提供了端到端的加密机制。其语法与HTTP 的语法相同，默认端口为443。
基本格式：
https://<host>:<port>/<path>?<query>#<frag>
示例：
https://www.joes-hardware.com/secure.html
  ● mailto 
Mailto URL 指向的是E-mail 地址。由于E-mail 的行为与其他方案都有所不同（它并不指向任何可以直接访问的对象），所以mailto URL 的格式与标准URL 的格式也有所不同。因特网E-mail 地址的语法记录在RFC 822 中。
基本格式：
mailto:<RFC-822-addr-spec>
示例：
mailto:liutao@mail.dhcc.com.cn
  ● ftp 
文件传输协议URL 可以用来从FTP 服务器上下载或向其上载文件，并获取FTP 服务器上的目录结构内容的列表。在Web 和URL 出现之前FTP 就已经存在了。Web 应用程序将FTP 作为一种数据访问方案使用。URL 语法遵循下列通用格式。
基本格式：
ftp://<user>:<password>@<host>:<port>/<path>;<params>
示例：
ftp://anonymous:joe%40joes-hardware.com@prep.ai.mit.edu:21/pub/gnu/
  ● rtsp，rtspu 
RTSP URL 是可以通过实时流传输协议（Real Time Streaming Protocol）解析的音/ 视频
媒体资源的标识符。方案rtspu 中的u 表示它是使用UDP 协议来获取资源的。
基本格式：
rtsp://<user>:<password>@<host>:<port>/<path>
rtspu://<user>:<password>@<host>:<port>/<path>
示例：
rtsp://www.joes-hardware.com:554/interview/cto_video
  ● file 
方案file 表示一台指定主机（通过本地磁盘、网络文件系统或其他一些文件共享系统）上可直接访问的文件。各字段都遵循通用格式。如果省略了主机名，就默认为正在使用URL 的本地主机。
基本格式：
file://<host>/<path>
示例：
file://OFFICE-FS/policies/casual-fridays.doc
  ● news 
根据RFC 1036 的定义，方案news 用来访问一些特定的文章或新闻组。它有一个很独特的性质：news URL 自身包含的信息不足以对资源进行定位。news URL 中缺乏到何处获取资源的信息——没有提供主机名或机器名称。从用户那里获取此类信息是解释程序的工作。比如，在网景浏览器的“选项”（Options）菜单中，就可以指定自己的NNTP（news）服务器。这样，浏览器有了news URL 的时候就知道应该使用哪个服务器了。
新闻资源可以从多台服务器中获得。它们被称为位置无关的，因为对它们的访问不依赖于任何一个源服务器。news URL 中保留了字符“@”，用来区分指向新闻组的news URL 和指向特定新闻文章的news URL。
基本格式：
news:<newsgroup>
news:<news-article-id>
示例：
news:rec.arts.startrek
  ● telnet 
方案telnet 用于访问交互式业务。它表示的并不是对象自身，而是可通过telnet 协议访问的交互式应用程序（资源）。
基本格式：
telnet://<user>:<password>@<host>:<port>/
示例：
telnet://slurp:webhound@joes-hardware.com:23/

2.6　未来展望						p44
URL 是一种强有力的工具。它可以用来命名所有现存对象，而且可以很方便地包含一些新格式。URL 还提供了一种可以在各种因特网协议间共享的统一命名机制。但URL 并不完美。它们表示的是实际的地址，而不是准确的名字。这就意味着URL 会告诉你资源此时处于什么位置。它会为你提供特定端口上特定服务器的名字，告诉你在何处可以找到这个资源。这种方案的缺点在于如果资源被移走了，
URL 也就不再有效了。那时，它就无法对对象进行定位了。
如果有了对象的准确名称，则不论其位于何处都可以找到这个对象，那该多完美啊。就像人一样，只要给定了资源的名称和其他一些情况，无论资源移到何处，你都能够追踪到它。
为了应对这个问题，因特网工程任务组（Internet Engineering Task Force，IETF）已经对一种名为统一资源名（uniform resource name，URN）的新标准做了一段时间的研究了。无论对象搬移到什么地方（在一个Web 服务器内或是在不同的Web服务器间），URN 都能为对象提供一个稳定的名称。
永久统一资源定位符（persistent uniform resource locators，PURL）是用URL 来实现URN 功能的一个例子。其基本思想是在搜索资源的过程中引入另一个中间层，通过一个中间资源定位符（resource locator）服务器对资源的实际URL 进行登记和跟踪。客户端可以向定位符请求一个永久URL，定位符可以以一个资源作为响应，将客户端重定向到资源当前实际的URL 上去（参见图2-6）。更多有关PURL 的信息，请访问http://purl.oclc.org。



