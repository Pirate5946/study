本章概要
• Web 客户端与服务器是如何通信的；
• （表示 Web 内容的）资源来自何方；
• Web 事务是怎样工作的；
• HTTP 通信所使用的报文格式；
• 底层 TCP 网络传输；
• 不同的 HTTP 协议变体；
• 因特网上安装的大量 HTTP 架构组件中的一部分。

1.1　HTTP——因特网的多媒体信使
Web 浏览器、服务器和相关的Web 应用程序都是通过HTTP 相互通信的。HTTP 是现代全球因特网中使用的公共语言。

1.2　Web客户端和服务器
Web 内容都是存储在Web 服务器上的。Web 服务器所使用的是HTTP 协议，因此经常会被称为HTTP 服务器
这些HTTP 服务器存储了因特网中的数据，如果HTTP 客户端发出请求的话，它们会提供数据。客户端向服务器发送HTTP 请求，服务器会在HTTP 响应中回送所请求的数据
HTTP 客户端和HTTP服务器共同构成了Web的基本组件。
最常见的HTTP 客户端 就是 Web浏览器，比如 IE，Google，360

1.3　资源					p5

1.3.1　媒体类型

1.3.2　URI	
每个Web 服务器资源都有一个名字，服务器资源名被称为统一资源标识符（Uniform Resource Identifier，URI）URI 就像因特网上的邮政地址一样，在世界范围内唯一标识并定位信息资源。
例如这是一张gif图片的URI http://www.joeshardware.com/specials/saw-blade.gif
给定了URI，HTTP 就可以解析出对象。
URI 有两种形式，分别称为URL 和URN。

1.3.3　URL							p8
统一资源定位符（URL）是资源标识符（URI）最常见的形式。
大部分URL 都遵循一种标准格式，这种格式包含三个部分。
  ● URL 的第一部分被称为方案（scheme），说明了访问资源所使用的协议类型。这部分通常就是HTTP 协议（http://）。
  ● 第二部分给出了服务器的因特网地址（比如，www.joeshardware.com）。
  ● 其余部分指定了 Web 服务器上的某个资源（比如，/specials/saw-blade.gif）。
现在，几乎所有的URI 都是URL。

1.3.4　URN
URI 的第二种形式就是统一资源名（URN）	
URN 是作为特定内容的唯一名称使用的，与目前的资源所在地无关。使用这些与位置无关的URN，就可以将资源四处搬移。通过URN，还可以用同一个名字通过多种网络访问协议来访问资源。
比如，不论因特网标准文档RFC 2141 位于何处（甚至可以将其复制到多个地方），都可以用下列URN 来命名它：
urn:ietf:rfc:2141
URN 仍然处于试验阶段，还未大范围使用。

1.4　事务						p9
一个HTTP 事务由一条（从客户端发往服务器的）请求命令和一个（从服务器发回客户端的）响应结果组成。这种通信是通过名为HTTP 报文（HTTP message）的格式化数据块进行的

1.4.1　方法
HTTP 支持几种不同的请求命令，这些命令被称为HTTP 方法（HTTP method）。每条HTTP 请求报文都包含一个方法。这个方法会告诉服务器要执行什么动作（获取一个Web 页面、运行一个网关程序、删除一个文件等）。
以下是五种常见的HTTP 方法。
      ○ GET 		从服务器向客户端发送命名资源
      ○ PUT 		将来自客户端的数据存储到一个命名的服务器资源中去
      ○ DELETE 	从服务器中删除命名资源
      ○ POST 		将客户端数据发送到一个服务器网关应用程序
      ○ HEAD 		仅发送命名资源响应中的HTTP 首部

1.4.2　状态码
每条HTTP 响应报文返回时都会携带一个状态码。状态码是一个三位数字的代码，告知客户端请求是否成功，或者是否需要采取其他动作
常见状态码
      ○ 200 OK					文档正确返回
      ○ 302 Redirect（重定向）	到其他地方去获取资源
      ○ 404 Not Found（没找到）	无法找到这个资源

1.4.3　Web页面中可以包含多个对象			p11
应用程序完成一项任务时通常会发布多个HTTP 事务，比如，Web 浏览器会发布一系列HTTP 事务来获取并显示一个包含了丰富图片的Web 页面。浏览器会执行一个事务来获取描述页面布局的HTML“框架”，然后发布另外的HTTP 事务来获取每个嵌入式图片、图像面板、Java 小程序等。这些嵌入式资源甚至可能位于不同的服务器上，因此，一个“Web 页面”通常并不是单个资源，而是一组
资源的集合。

1.5　报文
HTTP 报文是由一行一行的简单字符串组成的。HTTP 报文都是纯文本，不是二进制代码，所以人们可以很方便地对其进行读写
从Web 客户端发往Web 服务器的HTTP 报文称为请求报文（request message）。从服务器发往客户端的报文称为响应报文（response message），此外没有其他类型的HTTP 报文。
HTTP 报文包括以下三个部分。
• 起始行
报文的第一行就是起始行，在请求报文中用来说明要做些什么，在响应报文中说明出现了什么情况。
• 首部字段
起始行后面有零个或多个首部字段。每个首部字段都包含一个名字和一个值，为了便于解析，两者之间用冒号（:）来分隔。首部以一个空行结束。添加一个首部字段和添加新行一样简单。
• 主体
空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体中包括了要发送给Web 服务器的数据；响应主体中装载了要返回给客户端的数据。
起始行和首部都是文本形式且都是结构化的，而主体则不同，主体中可以包含任意的二进制数据（比如图片、视频、音轨、软件程序）。当然，主体中也可以包含文本。

简单的报文实例					p12
在图1-8 中，浏览器发送了一条HTTP 请求报文。这条请求的起始行中有一个GET命令，且本地资源为/tools.html。这条请求说明它使用的是1.0 版的HTTP 协议。请求的首部包含一些其他信息，请求报文没有主体，因为从服务器上GET 一个简单的文档不需要请求数据。
服务器会回送一条HTTP 响应报文。这条响应起始行中包含了HTTP 的版本号（HTTP/1.0）、一个成功状态码（200）、一个描述性的原因短语（OK）， 以及一块响应首部字段，在所有这些内容之后跟着包含了所请求文档的响应主体。Content-Length首部说明了响应主体的长度，Content-Type 首部说明了文档的MIME 类型。

1.6　连接
概要介绍了HTTP 报文的构成之后，我们来讨论一下报文是如何通过传输控制协议（Transmission Control Protocol，TCP）连接从一个地方搬移到另一个地方去的。

1.6.1　TCP/IP						p14		****
HTTP 是个应用层协议。HTTP 无需操心网络通信的具体细节；它把联网的细节都交给了通用、可靠的因特网传输协议TCP/IP。
TCP 提供了：
• 无差错的数据传输；
• 按序传输（数据总是会按照发送的顺序到达）；
• 未分段的数据流（可以在任意时刻以任意尺寸将数据发送出去）。
因特网自身就是基于TCP/IP 的，TCP/IP 是全世界的计算机和网络设备常用的层次化分组交换网络协议集。TCP/IP 隐藏了各种网络和硬件的特点及弱点，使各种类型的计算机和网络都能够进行可靠地通信。
只要建立了TCP 连接，客户端和服务器之间的报文交换就不会丢失、不会被破坏，也不会在接收时出现错序了。
用网络术语来说，HTTP 协议位于TCP 的上层。HTTP 使用TCP 来传输其报文数据。与之类似，TCP 则位于IP 的上层（参见图1-9）。

1.6.2　连接、IP地址及端口号			p15 ****
在HTTP 客户端向服务器发送报文之前，需要用网际协议（Internet Protocol，IP）地址和端口号在客户端和服务器之间建立一条TCP/IP 连接。
在TCP 中，你需要知道服务器的IP 地址，以及与服务器上运行的特定软件相关的TCP 端口号。
可以通过一种称为域名服务（Domain Name Service，DNS）的机制方便地将主机名转换为IP地址
浏览器是怎样通过HTTP 显示位于远端服务器中的某个简单HTML 资源的
步骤如下：
(a) 浏览器从URL 中解析出服务器的主机名；
(b) 浏览器将服务器的主机名转换成服务器的IP 地址；
(c) 浏览器将端口号（如果有的话）从URL 中解析出来；
(d) 浏览器建立一条与Web 服务器的TCP 连接；
(e) 浏览器向服务器发送一条HTTP 请求报文；
(f) 服务器向浏览器回送一条HTTP 响应报文；
(g) 关闭连接，浏览器显示文档。

1.6.3　一个使用Telnet的实例				p16
由于HTTP 使用了TCP/IP 传输协议，而且它是基于文本的，没有使用那些难以理解的二进制格式，因此很容易直接与Web 服务器进行对话。
Telnet 程序可以将键盘连接到某个目标TCP 端口，并将此TCP 端口的输出回送到显示屏上。Telnet 常用于远程终端会话，但它几乎可以连接所有的TCP 服务器，包括HTTP 服务器。

1.7　协议版本					p18
现在使用的HTTP 协议有几个版本。HTTP 应用程序要尽量强健地处理各种不同的HTTP 协议变体。目前仍在使用的版本如下。
  ● HTTP/0.9
HTTP 的1991 原型版本称为HTTP/0.9。这个协议有很多严重的设计缺陷，只应
该用于与老客户端的交互。
  ● HTTP/1.0
1.0 是第一个得到广泛使用的HTTP 版本。HTTP/1.0 添加了版本号、各种HTTP首部、一些额外的方法，以及对多媒体对象的处理
  ● HTTP/1.1
HTTP/1.1 重点关注的是校正HTTP 设计中的结构性缺陷，明确语义，引入重要的性能优化措施，并删除一些不好的特性,HTTP/1.1 是当前使用的HTTP 版本。
  ● HTTP/2.0
HTTP/1.1 后继结构的原型建议，它重点关注的是性能的大幅优化，以及更强大的服务逻辑远程执行框架

1.8　Web的结构组件			p19
在本章的概述中，我们重点介绍了两个Web 应用程序（Web 浏览器和Web 服务器）是如何相互发送报文来实现基本事务处理的。
在因特网上，要与很多Web 应用程序进行交互。在本节中，我们将列出其他一些比较重要的应用程序，如下所示。
• 代理
位于客户端和服务器之间的HTTP 中间实体。
• 缓存
HTTP 的仓库，使常用页面的副本可以保存在离客户端更近的地方。
• 网关
连接其他应用程序的特殊Web 服务器。
• 隧道
对HTTP 通信报文进行盲转发的特殊代理。
• Agent 代理
发起自动HTTP 请求的半智能Web 客户端。

1.8.1　	代理
首先我们来看看HTTP 代理服务器，这是Web 安全、应用集成以及性能优化的重要组成模块。
代理位于客户端和服务器之间，接收所有客户端的HTTP 请求，并将这些请求转发给服务器（可能会对请求进行修改之后转发）。
出于安全考虑，通常会将代理作为转发所有Web 流量的可信任中间节点使用。代理还可以对请求和响应进行过滤。比如，在企业中对下载的应用程序进行病毒检测，或者对小学生屏蔽一些成人才能看的内容。

1.8.2　缓存						
Web 缓存（Web cache）或代理缓存（proxy cache）是一种特殊的HTTP 代理服务器，可以将经过代理传送的常用文档复制保存起来。下一个请求同一文档的客户端就可以享受缓存的私有副本所提供的服务了
客户端从附近的缓存下载文档会比从远程Web 服务器下载快得多。HTTP 定义了很多功能，使得缓存更加高效，并规范了文档的新鲜度和缓存内容的隐私性

1.8.3　网关							p20
网关（gateway）是一种特殊的服务器，作为其他服务器的中间实体使用。通常用于将HTTP 流量转换成其他的协议。网关接受请求时就好像自己是资源的源端服务器一样。客户端可能并不知道自己正在与一个网关进行通信。
例如，一个HTTP/FTP 网关会通过HTTP 请求接收对FTP URI 的请求，但通过FTP协议来获取文档（参见图1-13）。得到的文档会被封装成一条HTTP 报文，发送给客户端。

1.8.4　隧道						p21
隧道（tunnel）是建立起来之后，就会在两条连接之间对原始数据进行盲转发的HTTP 应用程序。HTTP 隧道通常用来在一条或多条HTTP 连接上转发非HTTP 数据，转发时不会窥探数据。
HTTP 隧道的一种常见用途是通过HTTP 连接承载加密的安全套接字层（SSL，Secure Sockets Layer）流量，这样SSL 流量就可以穿过只允许Web 流量通过的防火墙了

1.8.5　Agent代理
用户Agent 代理（或者简称为Agent 代理）是代表用户发起HTTP 请求的客户端程序。所有发布Web 请求的应用程序都是HTTP Agent 代理。到目前为止，我们只提到过一种HTTP Agent 代理：Web 浏览器，但用户Agent 代理还有很多其他类型。
比如，有些自己会在Web 上闲逛的自动用户Agent 代理，可以在无人监视的情况下发布HTTP 事务并获取内容。这些自动代理的名字通常都很生动，比如“网络蜘蛛”（spiders）或者“Web 机器人”（Web robots）
