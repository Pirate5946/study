本章内容：
- 定义Spring对数据访问的支持
- 配置数据库资源
- 使用Spring的JDBC模版

## 10.1　Spring的数据访问哲学
为了避免持久化的逻辑分散到应用的各个组件中，最好将数据访问的功能放到一个或多个专注于此项任务的组件中。  
这样的组件通常称为数据访问对象（data access object，DAO）或Repository。

尽管Spring鼓励使用接口，但这并不是强制的——你可以使用Spring将bean（DAO或其他类型）直接装配到另一个bean的某个属性中，而不需要一定通过接口注入。

为了将数据访问层与应用程序的其他部分隔离开来，Spring采用的方式之一就是提供统一的异常体系，这个异常体系用在了它支持的所有持久化方案中。

### 10.1.1　了解Spring的数据访问异常体系
使用JDBC时可能导致抛出SQLException的常见问题包括：
- 应用程序无法连接数据库；
- 要执行的查询存在语法错误；
- 查询中所使用的表和/或列不存在；
- 试图插入或更新的数据违反了数据库约束。

一些持久化框架提供了相对丰富的异常体系。例如，Hibernate提供了二十个左右的异常，分别对应于特定的数据访问问题。  
这样就可以针对想处理的异常编写catch代码块

我们需要的数据访问==异常要具有描述性==而且又==与特定的持久化框架无关==。

> Spring所提供的平台无关的持久化异常

Spring JDBC提供的数据访问异常体系解决了以上的两个问题。不同于JDBC，Spring提供了多个数据访问异常，分别描述了它们抛出时所对应的问题。

#### 表10.1　JDBC的异常体系与Spring的数据访问异常 p354
表10.1中没有体现出来的一点就是这些异常都继承自DataAccessException。   
DataAccessException的特殊之处在
于它是一个非检查型异常。换句话说，没有必要捕获Spring所抛出的数据访问异常（当然，如果你想捕获的话也是完全可以的）。

DataAccessException只是Sping处理检查型异常和非检查型异常哲学的一个范例。    
Spring认为触发异常的很多问题是不能在catch代码块中修复的。    
Spring使用了非检查型异常，而不是强制开发人员编写catch代码块（里面经常是空的）。   
这把是否要捕获异常的权力留给了开发人员。

### 10.1.2　数据访问模板化
#### 模板方法模式
模板方法将过程中与特定实现相关的部分委托给接口，而这个接口的不同实现定义了过程中的具体行为。

Spring将数据访问过程中固定的和可变的部分明确划分为两个不同的类：
- 模板（template）
    - 事务控制、
    - 管理资源
    - 处理异常
- 回调（callback）。    
    - 应用程序相关的数据访问语句
    - 绑定参数
    - 整理结果集

针对不同的持久化平台，Spring提供了多个可选的模板。
- 如果直接使用JDBC，那你可以选择JdbcTemplate。
- 如果你希望使用对象关系映射框架，那HibernateTemplate或JpaTemplate可能会更适合你。

#### 表10.2　Spring提供的数据访问模板，分别适用于不同的持久化机制

Spring所支持的大多数持久化功能都依赖于数据源。因此，在声明模板和Repository之前，我们需要在Spring中配置一个数据源用来连接数据库。
## 10.2　配置数据源
Spring提供了在Spring上下文中配置数据源bean的多种方式，包括：
- 通过JDBC驱动程序定义的数据源；
- 通过JNDI查找的数据源；
- 连接池的数据源。

对于即将发布到生产环境中的应用程序，建议使用从连接池获取连接的数据源。    
如果可能的话，我倾向于通过应用服务器的JNDI来获取数据源。
### 10.2.1　使用JNDI数据源
利用Spring，我们可以像使用Spring bean那样配置JNDI中数据源的引用并将其装配到需要的类中。  
- xml配置方式   
位于jee命名空间下的<jee:jndilookup>
元素可以用于检索JNDI中的任何对象（包括数据源）并将其作为Spring的bean
- Java配置  
借助
JndiObjectFactoryBean从JNDI中查找DataSource：

### 10.2.2　==使用数据源连接池==
尽管Spring并没有提供数据源连接池实现，但是我们有多项可用的方案，包括如下开源的实现：
- Apache Commons DBCP (http://jakarta.apache.org/commons/dbcp)；
- c3p0 (http://sourceforge.net/projects/c3p0/) ；
- BoneCP (http://jolbox.com/) 。

这些连接池中的大多数都能配置为Spring的数据源，在一定程度上与
Spring自带的DriverManagerDataSource
或SingleConnectionDataSource很类似

### 10.2.3　基于JDBC驱动的数据源
与具备池功能的数据源相比，唯一的区别在于这些数据源bean都没有提供连接池功能，所以没有可配置的池相关的属性。

尽管这些数据源对于小应用或开发环境来说是不错的，但是要将其用于生产环境，你还是需要慎重考虑。    
因为SingleConnectionDataSource有且只有一个数据库连接，所以不适合用于多线程的应用程序，==最好只在测试的时候使用。==

==建议应该使用数据源连接池==

### 10.2.4　使用嵌入式的数据源
对于开发和测试来讲，嵌入式数据库都是很好的可选方案。    
这是因为每次重启应用或运行测试的时候，都能够重新填充测试数据。

### 10.2.5　使用profile选择数据源
#### 程序清单10.2　借助Spring的profile特性能够在运行时选择数据源
#### 程序清单10.3　借助XML配置，基于profile选择数据源

## 10.3　在Spring中使用JDBC
### 10.3.2　使用JDBC模板
Spring的JDBC框架承担了资源管理和异常处理的工作，从而简化了JDBC代码，让我们只需编写从数据库读写数据的必需代码。

Spring将数据访问的样板代码抽象到模板
类之中。Spring为JDBC提供了三个模板类供选择：

对于大多数的JDBC任务来说，==JdbcTemplate类==就是最好的可选方案

#### 使用JdbcTemplate来插入数据

#### 使用命名参数 p374
NamedParameterJdbcTemplate是一个特殊的JDBC模板类，它支持使用命名参数

## 10.4　小结

























